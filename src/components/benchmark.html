<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../css/reset.css" />
    <link rel="stylesheet" href="../css/style.css" />
    <title>Benchmark - Epicode</title>
  </head>
  <body>
    <header>
      <div>
        <img src="../img/epicode_logo.png" />
      </div>
    </header>
    <main>
      <div>
        <p id="timer">tempo</p>
      </div>
      <div>
        <h1 id="titolo_domanda">How can I create</h1>
      </div>
      <div style="height: 300px">
        <button id="risposta_1">Question1</button>
        <button id="risposta_2">Question2</button>
        <button id="risposta_3">Question3</button>
        <button id="risposta_4">Question4</button>
      </div>
      <div>
        <p>Question</p>
      </div>

      <script>
        let quantita = 10;
        let livello = "easy";
        let domande = [];
        let completa = true;
        let titolo = document.getElementById("titolo_domanda");
        let timer = document.getElementById("timer");
        let pulsante_1 = document.getElementById("risposta_1");
        let pulsante_2 = document.getElementById("risposta_2");
        let pulsante_3 = document.getElementById("risposta_3");
        let pulsante_4 = document.getElementById("risposta_4");
        let punteggio = 0;

        fetch(
          `https://opentdb.com/api.php?amount=${quantita}&category=18&difficulty=${livello}`
        )
          .then((response) => response.json())
          .then((domande) => {
            getFetch(domande.results);
            // console.log(domande.results);

            // Raccolto tutto il codice fatto finora in una funzione
            function getFetch(domande) {
              for (let i = 0; i < domande.length; i++) {
                const domanda = domande[i];
                let risposte = [];

                // console.log(domanda); // DEBUG => Completo dell'oggetto della domanda

                // Sostituisce il testo dell'H1 con il titolo della domanda presa dal fetch
                titolo.innerHTML = domanda.question;

                // Aggiunge al vettore "risposte" la risposta corretta
                risposte.push(domanda.correct_answer);

                // Aggiunge al vettore "risposte" le risposte Errate
                for (const risposta of domanda.incorrect_answers) {
                  risposte.push(risposta);
                }

                // console.log(risposte); // DEBUG => Vettore con risposte

                // Mescola tutti gli elementi del vettore
                shuffle(risposte);

                // Controlla il tipo di domanda se boleana o multipla
                domanda.type == "boolean"
                  ? pulsanti_risposte(risposte, true)
                  : pulsanti_risposte(risposte, false);

                pulsante_1.addEventListener("click", function () {
                  controllaRisposte(pulsante_1, domanda);
                });
                pulsante_2.addEventListener("click", function () {
                  controllaRisposte(pulsante_2, domanda);
                });
                pulsante_3.addEventListener("click", function () {
                  controllaRisposte(pulsante_3, domanda);
                });
                pulsante_4.addEventListener("click", function () {
                  controllaRisposte(pulsante_4, domanda);
                });
              }
            }

            function controllaRisposte(risposta, domanda) {

            }

            function pulsanti_risposte(risposte, is_boolean) {
              if (is_boolean) {
                pulsante_1.innerHTML = risposte[0];
                pulsante_2.innerHTML = risposte[1];
                pulsante_3.classList.add("nascondi");
                pulsante_4.classList.add("nascondi");
              } else {
                pulsante_1.innerHTML = risposte[0];
                pulsante_2.innerHTML = risposte[1];
                pulsante_3.innerHTML = risposte[2];
                pulsante_4.innerHTML = risposte[3];
                pulsante_3.classList.remove("nascondi");
                pulsante_4.classList.remove("nascondi");
              }
            }

            function shuffle(array) {
              let currentIndex = array.length,
                randomIndex;

              // While there remain elements to shuffle.
              while (currentIndex != 0) {
                // Pick a remaining element.
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;

                // And swap it with the current element.
                [array[currentIndex], array[randomIndex]] = [
                  array[randomIndex],
                  array[currentIndex],
                ];
              }

              return array;
            }
          });
      </script>
    </main>
  </body>
</html>
